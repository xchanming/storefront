"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[554],{554:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var i=s(4343);async function r(e){let t=await n(e),s=document.createElement("a");s.innerHTML="<picture></picture>",s.setAttribute("rel","ar"),s.setAttribute("download","model.usdz"),s.setAttribute("href",t),s.style.display="none",document.body.appendChild(s),s.click(),s.remove()}async function n(e){let t=new window.threeJsAddons.USDZExporter,s=new Blob([await t.parse(e)],{type:"model/vnd.usdz+zip"});return URL.createObjectURL(s)}var o=s(4335);async function a(){return await l()||d()}function d(){if(document.createElement("a").relList.supports("ar"))return!0;let e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,t=navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);if(!e||!t||12>parseInt(t[1],10))return!1;let s=/CriOS/.test(navigator.userAgent),i=/EdgiOS/.test(navigator.userAgent),r=/Ddg/.test(navigator.userAgent);return s||i||r}async function l(){return!!navigator.xr&&await navigator.xr.isSessionSupported("immersive-ar")}class h{constructor(e,t){this.scene=e,this.renderer=t,this.defaultLight=new window.threeJs.HemisphereLight(0xffffff,0xbbbbff,1),this.defaultLight.position.set(.5,1,.25),this.scene.add(this.defaultLight),this.xrLight=new window.threeJsAddons.XREstimatedLight(this.renderer),this.initializeEventListeners()}initializeEventListeners(){this.xrLight.addEventListener("estimationstart",this.onEstimationStart.bind(this)),this.xrLight.addEventListener("estimationend",this.onEstimationEnd.bind(this))}onEstimationStart(){this.scene.add(this.xrLight),this.scene.remove(this.defaultLight),this.xrLight.environment&&(this.scene.environment=this.xrLight.environment)}onEstimationEnd(){this.scene.add(this.defaultLight),this.scene.remove(this.xrLight),this.scene.environment=null}dispose(){this.xrLight.removeEventListener("estimationstart",this.onEstimationStart.bind(this)),this.xrLight.removeEventListener("estimationend",this.onEstimationEnd.bind(this))}}class c{constructor(e,t){this.renderer=e,this.scene=t;let s=new window.threeJs.RingGeometry(.18,.2,32).rotateX(-Math.PI/2),i=new window.threeJs.MeshBasicMaterial;this.marker=new window.threeJs.Mesh(s,i),this.marker.matrixAutoUpdate=!1,this.marker.visible=!1,this.scene.add(this.marker),this.lastHitPose=null,this.hitTestSource=null,this.hitTestSourceRequested=!1}update(e){return e instanceof XRFrame&&(this.updateHits(e),this.updateMarker(),this.hitTestSourceRequested||this.requestHitTestSource().then(),!!this.lastHitPose)}updateHits(e){if(!this.hitTestSource)return;let t=e.getHitTestResults(this.hitTestSource);if(t.length){let e=t[0].getPose(this.renderer.xr.getReferenceSpace());this.lastHitPose=e.transform.matrix}else this.lastHitPose=null}updateMarker(){null!==this.lastHitPose?(this.marker.visible=this.markerVisible,this.marker.matrix.fromArray(this.lastHitPose)):this.marker.visible=!1}getHitPose(){return new window.threeJs.Matrix4().fromArray(this.lastHitPose)}hideMarker(){this.markerVisible=!1}showMarker(){this.markerVisible=!0}dispose(){this.hitTestSourceRequested=!1,this.hitTestSource=null,this.marker.visible=!1,this.scene.remove(this.marker)}async requestHitTestSource(){let e=this.renderer.xr.getSession(),t=await e.requestReferenceSpace("viewer");this.hitTestSource=await e.requestHitTestSource({space:t,entityTypes:["plane"]}),this.hitTestSourceRequested=!0}}class w{constructor(e,t,s){this.renderer=e,this.scene=t,this.model=s,this.model.visible=!1,this.placed=!1,this.selectedObject=null,this.webXrHitTest=new c(this.renderer,this.scene),this.raycaster=new window.threeJs.Raycaster}update(e){return this.webXrHitTest.update(e)}placeObject(){let e=this.webXrHitTest.getHitPose();e&&(this.model.position.setFromMatrixPosition(e),this.model.visible=!0,this.placed=!0,this.webXrHitTest.hideMarker())}resetPlacement(){this.model.visible=!1,this.webXrHitTest.showMarker()}dispose(){this.webXrHitTest.dispose()}}class m{static #e=this.options={overlay:"[data-spatial-ar-overlay]",exitButton:"[data-spatial-ar-overlay-exit]",progressBar:"[data-spatial-ar-overlay-progress]",classes:{visible:"is--visible",loading:"is--loading",placementHint:"is--placement-hint",tracking:"is--tracking",sessionRunning:"is--session-running"},placementHintTimeout:3e3};constructor(e){this.progress=0,this.overlay=e,this.overlay.classList.add(m.options.classes.visible),this.overlay.classList.add(m.options.classes.loading),this.overlay.classList.add(m.options.classes.placementHint),this.exitButton=this.overlay.querySelector(m.options.exitButton),this.progressBar=this.overlay.querySelector(m.options.progressBar),this.startProgress()}sessionStarted(){this.overlay.classList.remove(m.options.classes.loading),this.overlay.classList.add(m.options.classes.sessionRunning)}sessionEnded(){this.overlay.classList.remove(m.options.classes.sessionRunning),this.overlay.classList.remove(m.options.classes.visible),this.overlay.classList.remove(m.options.classes.loading),this.overlay.classList.remove(m.options.classes.placementHint),this.overlay.classList.remove(m.options.classes.tracking)}trackingStarted(){this.overlay.classList.add(m.options.classes.tracking)}get element(){return this.overlay}addExitListener(e){this.exitButton.addEventListener("click",e)}removeExitListener(e){this.exitButton.removeEventListener("click",e)}startProgress(){this.progress=0;let e=setInterval(()=>{this.progress+=1,this.progressBar.style.width=`${this.progress}%`,this.progressBar.setAttribute("aria-valuenow",`${this.progress}`),this.progress>=100&&(clearInterval(e),this.overlay.classList.remove(m.options.classes.placementHint))},m.options.placementHintTimeout/100)}}class p{constructor(e,t){this.overlay=t?new m(t):null,this.camera=new window.threeJs.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,1.6,3),this.scene=new window.threeJs.Scene,this.model=e,this.model.visible=!1,this.scene.add(this.model),this.renderer=new window.threeJs.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.xr.enabled=!0,document.body.appendChild(this.renderer.domElement),this.overlay?.removeExitListener(this.endSession.bind(this)),this.overlay?.addExitListener(this.endSession.bind(this)),this.objectPlacement=new w(this.renderer,this.scene,this.model),this.lighting=new h(this.scene,this.renderer),this.controller=this.renderer.xr.getController(0),this.controller.addEventListener("select",this.objectPlacement.placeObject.bind(this.objectPlacement)),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["local","hit-test"],optionalFeatures:["light-estimation","local-floor","dom-overlay"],domOverlay:{root:this.overlay.element}}).then(this.onSessionStarted.bind(this))}render(e,t){this.objectPlacement.update(t)&&this.overlay?.trackingStarted(),this.renderer.render(this.scene,this.camera)}endSession(){this.session.end().then()}async onSessionStarted(e){this.session=e,this.session.addEventListener("end",this.onSessionEnded.bind(this));let t=this.session.enabledFeatures?.includes("local-floor")?"local-floor":"local";this.renderer.xr.setReferenceSpaceType(t),await this.renderer.xr.setSession(this.session),this.renderer.xr.getReferenceSpace().addEventListener("reset",this.objectPlacement.resetPlacement.bind(this.objectPlacement)),this.renderer.setAnimationLoop(this.render.bind(this)),this.overlay.sessionStarted()}onSessionEnded(){this.renderer.setAnimationLoop(null),this.objectPlacement.dispose(),this.session.removeEventListener("end",this.onSessionEnded.bind(this)),this.session.end(),this.overlay.sessionEnded(),this.lighting.dispose()}}var u=s(9926);class v extends o.A{async init(){await (0,u.K)(),this.modelUrl=this.options.modelUrl,this.supportsAr=await a(),this.modelUrl&&(this.objectLoader=new i.A,this.objectLoader.loadSingleObjectByUrl(this.modelUrl,{center:!0,clampSize:!1}).then(e=>{this.model=e,this.onReady()}),this.el.addEventListener("click",()=>{this.startARView().then()}))}async startARView(){if(!this.model||!this.supportsAr){let e;if(e=this.options?.spatialArId?document.querySelector(`.ar-qr-modal [data-ar-model-id='${this.options?.spatialArId}']`)?.closest(".ar-qr-modal"):document.querySelector(".ar-qr-modal"),e?.closest("body")?.appendChild(e),e){window.focusHandler.saveFocusState("spatial-ar-viewer");let t=()=>{window.focusHandler.resumeFocusState("spatial-ar-viewer"),s._element.removeEventListener("hidden.bs.modal",t)},s=new bootstrap.Modal(e);s._element.addEventListener("hidden.bs.modal",t),s.show()}return}if(await l()){this.startWebXRView();return}if(d()){this.startIOSQuickLook();return}}startIOSQuickLook(){r(this.model).then()}startWebXRView(){let e=this.el.parentElement.querySelector("[data-spatial-ar-overlay]");new p(this.model,e)}onReady(){this.el.classList.add("spatial-ar-ready");let e=new URLSearchParams(window.location.search);if(e.has("autostartAr")&&this.options?.spatialArId&&null==window.autostartingARView&&e.get("autostartAr")==this.options?.spatialArId){if(window.autostartingARView=!0,!this.options?.spatialArId)return;let e=document.querySelector(`.ar-qr-modal-open-session [data-modal-open-ar-session-autostart='${this.options?.spatialArId}']`)?.closest(".ar-qr-modal-open-session");if(!e)return;e.getElementsByClassName("ar-btn-open-session")[0]?.addEventListener("click",()=>{this.startARView().then()}),e?.closest("body")?.appendChild(e),new bootstrap.Modal(e).show()}}}},4343:(e,t,s)=>{s.d(t,{A:()=>r});var i=s(8308);class r{constructor(e){this.gltfLoader=new window.threeJsAddons.GLTFLoader;let t=new window.threeJsAddons.DRACOLoader;t.setDecoderPath(e?.options.dracoDecodersPath),this.gltfLoader.setDRACOLoader(t),this.loadStatus=new Map,e?.$emitter instanceof i.A&&(this.$emitter=e?.$emitter)}async loadSingleObjectByUrl(e,t){this.loadStatus.set(e,0),this.emitLoadingUpdate();let s=await new Promise((t,s)=>{this.gltfLoader.load(e,s=>{this.loadStatus.set(e,1),this.emitLoadingUpdate(),t(s.scene)},t=>{this.loadStatus.set(e,t.loaded/t.total),this.emitLoadingUpdate()},t=>{this.loadStatus.set(e,-1),this.emitLoadingUpdate(),s(t)})});return t.clampSize&&(s=this.clampSize(s,t.clampMaxSize)),t.center&&(s=this.centerObject(s)),s}centerObject(e){let t=new window.threeJs.Box3().setFromObject(e).getCenter(new window.threeJs.Vector3);e.position.copy(t),e.position.multiplyScalar(-1);let s=new window.threeJs.Group;return s.name="centered",s.add(e),s}clampSize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:1,y:1,z:1},s=new window.threeJs.Box3().setFromObject(e).getSize(new window.threeJs.Vector3),i=Math.max(s.x*(1/t.x),s.y*(1/t.y),s.z*(1/t.z));return e.scale.multiplyScalar(1/i),e}percentageLoaded(){let e=0,t=0;return this.loadStatus.forEach(s=>{t+=s,e++}),t/e}detailLoaded(){return this.loadStatus}emitLoadingUpdate(){this.$emitter&&this.$emitter.publish("ObjectLoaderUtil/loadingUpdate",{percentage:this.percentageLoaded(),detailed:this.detailLoaded()})}}},9926:(e,t,s)=>{s.d(t,{K:()=>i});async function i(){if(window.loadThreeJsUtil||(window.loadThreeJsUtil={isLoaded:!1,promise:null,promiseResolve:null}),!window.loadThreeJsUtil.isLoaded){if(window.loadThreeJsUtil.promise){await window.loadThreeJsUtil.promise;return}if(window.loadThreeJsUtil.promise=new Promise(e=>{window.loadThreeJsUtil.promiseResolve=e}),window.threeJs||(window.threeJs=await s.e(99451).then(s.bind(s,9451))),window.threeJsAddons||(window.threeJsAddons={}),!window.threeJsAddons?.OrbitControls){let{OrbitControls:e}=await Promise.all([s.e(99451),s.e(1970)]).then(s.bind(s,1970));window.threeJsAddons.OrbitControls=e}if(!window.threeJsAddons?.USDZExporter){let{USDZExporter:e}=await Promise.all([s.e(99451),s.e(79965)]).then(s.bind(s,9965));window.threeJsAddons.USDZExporter=e}if(!window.threeJsAddons?.XREstimatedLight){let{XREstimatedLight:e}=await Promise.all([s.e(99451),s.e(14692)]).then(s.bind(s,4692));window.threeJsAddons.XREstimatedLight=e}if(!window.threeJsAddons?.GLTFLoader){let{GLTFLoader:e}=await Promise.all([s.e(99451),s.e(86374)]).then(s.bind(s,6374));window.threeJsAddons.GLTFLoader=e}if(!window.threeJsAddons?.DRACOLoader){let{DRACOLoader:e}=await Promise.all([s.e(99451),s.e(37098)]).then(s.bind(s,7098));window.threeJsAddons.DRACOLoader=e}window.threeJsAddons?.DRACOLibPath||(window.threeJsAddons.DRACOLibPath="three/examples/jsm/libs/draco/"),window.threeJsAddons?.MathUtils||(window.threeJsAddons.MathUtils=await s.e(52905).then(s.bind(s,2905))),window.loadThreeJsUtil.promiseResolve(),window.loadThreeJsUtil.isLoaded=!0}}}}]);