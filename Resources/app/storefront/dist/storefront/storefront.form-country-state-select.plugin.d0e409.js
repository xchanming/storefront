"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[86300],{6300:(e,t,i)=>{i.r(t),i.d(t,{default:()=>s});var r=i(9568),n=i(4049),o=i(3107);class s extends r.Z{static #e=this.options={countrySelectSelector:".country-select",initialCountryAttribute:"initial-country-id",countryStateSelectSelector:".country-state-select",initialCountryStateAttribute:"initial-country-state-id",countryStatePlaceholderSelector:'[data-placeholder-option="true"]',vatIdFieldInput:"#vatIds",zipcodeFieldInput:'[data-input-name="zipcodeInput"]',vatIdRequired:"vat-id-required",stateRequired:"state-required",zipcodeRequired:"zipcode-required",zipcodeLabel:"#zipcodeLabel",scopeElementSelector:null,prefix:null};init(){this.initClient(),this.initSelects(),this._getFormFieldToggleInstance(),this._formFieldToggleInstance&&this._formFieldToggleInstance.$emitter.subscribe("onChange",this._onFormFieldToggleChange.bind(this))}initClient(){this._client=new o.Z}initSelects(){this.scopeElement=this.el,this.options.scopeElementSelector&&(this.scopeElement=n.Z.querySelector(document,this.options.scopeElementSelector));let{countrySelectSelector:e,countryStateSelectSelector:t,initialCountryAttribute:i,initialCountryStateAttribute:r}=s.options,o=n.Z.querySelector(this.scopeElement,e),d=n.Z.querySelector(this.scopeElement,t),a=n.Z.getDataAttribute(o,i,!1),l=n.Z.getDataAttribute(d,r,!1),u=o.options[o.selectedIndex],c=!!n.Z.getDataAttribute(u,this.options.vatIdRequired,!1),p=document.querySelector(this.options.vatIdFieldInput),h=!!n.Z.getDataAttribute(u,this.options.stateRequired,!1),S=n.Z.querySelectorAll(this.scopeElement,this.options.zipcodeLabel,!1),q=n.Z.querySelectorAll(this.scopeElement,this.options.zipcodeFieldInput,!1),g=!!n.Z.getDataAttribute(u,this.options.zipcodeRequired,!1);o.addEventListener("change",this.onChangeCountry.bind(this)),a&&(this.requestStateData(a,l,h),g&&(window.Feature.isActive("ACCESSIBILITY_TWEAKS")?this._updateZipcodeFields(q,g):this._updateZipcodeRequired(S,q,g)),p&&(window.Feature.isActive("ACCESSIBILITY_TWEAKS")?this._updateVatIdField(p,c):this._updateRequiredVatId(p,c)))}onChangeCountry(e){let t=e.target.value,i=e.target.options[e.target.selectedIndex],r=!!n.Z.getDataAttribute(i,this.options.stateRequired);this.requestStateData(t,null,r);let o=n.Z.getDataAttribute(i,this.options.vatIdRequired),s=document.querySelector(this.options.vatIdFieldInput),d=n.Z.querySelectorAll(this.scopeElement,this.options.zipcodeLabel,!1),a=n.Z.querySelectorAll(this.scopeElement,this.options.zipcodeFieldInput,!1),l=!!n.Z.getDataAttribute(i,this.options.zipcodeRequired,!1);window.Feature.isActive("ACCESSIBILITY_TWEAKS")?this._updateZipcodeFields(a,l):this._updateZipcodeRequired(d,a,l),s&&(window.Feature.isActive("ACCESSIBILITY_TWEAKS")?this._updateVatIdField(s,o):this._updateRequiredVatId(s,o))}requestStateData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=JSON.stringify({countryId:e});this._client.post(window.router["frontend.country.country-data"],r,e=>{if(window.Feature.isActive("ACCESSIBILITY_TWEAKS")){let r=JSON.parse(e);this._updateStateSelect(r.states,i,t)}else{let r=JSON.parse(e);!function(e,t,i,r){let{stateRequired:o,states:s}=e,{countryStateSelectSelector:d,countryStatePlaceholderSelector:a}=r,l=n.Z.querySelector(i,d);(function(e,t){e.querySelectorAll(t).forEach(e=>e.remove())})(l,`option:not(${a})`),function(e,t,i){if(0===t.length){e.parentNode.classList.add("d-none"),e.setAttribute("disabled","disabled");return}t.map(e=>(function(e,t){let i=document.createElement("option");return i.setAttribute("value",e.id),i.innerText=e.translated.name,e.id===t&&i.setAttribute("selected","selected"),i})(e,i)).forEach(t=>{e.append(t)}),e.parentNode.classList.remove("d-none"),e.removeAttribute("disabled")}(l,s,t),function(e,t,i){let r=e.querySelector(i),n=e.parentNode.querySelector("label");if(t){r.setAttribute("disabled","disabled"),e.setAttribute("required","required"),n?.textContent&&"*"!==n.textContent.substr(-1,1)&&(n.textContent=`${n.textContent.trim()}*`);return}n?.textContent&&"*"===n.textContent.substr(-1,1)&&(n.textContent=n.textContent.substr(0,n.textContent.length-1)),r.removeAttribute("disabled"),e.removeAttribute("required")}(l,o,`option${a}`)}(r={...r,stateRequired:i},t,this.el,s.options)}})}_updateVatIdField(e,t){this._differentShippingCheckbox&&"billingAddress"===this.options.prefix||(t?window.formValidation.setFieldRequired(e):window.formValidation.setFieldNotRequired(e))}_updateRequiredVatId(e,t){if(this._differentShippingCheckbox&&"billingAddress"===this.options.prefix)return;let i=e.parentNode.querySelector("label");if(t){e.setAttribute("required","required"),i?.textContent&&"*"!==i.textContent.substr(-1,1)&&(i.textContent=`${i.textContent}*`);return}i?.textContent&&"*"===i.textContent.substr(-1,1)&&(i.textContent=i.textContent.substr(0,i.textContent.length-1)),e.removeAttribute("required")}_updateZipcodeFields(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&e.forEach(e=>{!0===t?window.formValidation.setFieldRequired(e):window.formValidation.setFieldNotRequired(e)})}_updateZipcodeRequired(e,t,i){e&&t&&(e.forEach(e=>{e.className=i?"":"d-none"}),t.forEach(e=>{i?e.setAttribute("required","required"):e.removeAttribute("required")}))}_updateStateSelect(e,t,i){let r=n.Z.querySelector(this.scopeElement,this.options.countryStateSelectSelector),o=r.querySelector(this.options.countryStatePlaceholderSelector);this._removeStateOptions(r),this._addStateOptions(e,i,r),t?(window.formValidation.setFieldRequired(r),o.setAttribute("disabled","disabled")):(window.formValidation.setFieldNotRequired(r),o.removeAttribute("disabled"))}_removeStateOptions(e){let t=`option:not(${this.options.countryStatePlaceholderSelector})`,i=e;e||(i=n.Z.querySelector(this.scopeElement,this.options.countryStateSelectSelector)),i.querySelectorAll(t).forEach(e=>e.remove())}_addStateOptions(e,t,i){let r=i;if(i||(r=n.Z.querySelector(this.scopeElement,this.options.countryStateSelectSelector)),0===e.length){r.parentNode.classList.add("d-none"),r.setAttribute("disabled","disabled");return}e.map(e=>this._createStateOptionEl(e,t)).forEach(e=>{r.append(e)}),r.parentNode.classList.remove("d-none"),r.removeAttribute("disabled")}_createStateOptionEl(e,t){let i=document.createElement("option");return i.setAttribute("value",e.id),i.innerText=e.translated.name,e.id===t&&i.setAttribute("selected","selected"),i}_getFormFieldToggleInstance(){let e=n.Z.querySelector(document,'[data-form-field-toggle-target=".js-form-field-toggle-shipping-address"]',!1);e&&(this._formFieldToggleInstance=window.PluginManager.getPluginInstanceFromElement(e,"FormFieldToggle"))}_onFormFieldToggleChange(e){this._differentShippingCheckbox=e.target.checked;let t=this._differentShippingCheckbox?".register-shipping":".register-billing",i=n.Z.querySelector(document,t),r=n.Z.querySelector(i,this.options.countrySelectSelector),o=r.options[r.selectedIndex],s=!!n.Z.getDataAttribute(o,this.options.vatIdRequired,!1),d=document.querySelector(this.options.vatIdFieldInput);d&&(window.Feature.isActive("ACCESSIBILITY_TWEAKS")?this._updateVatIdField(d,s):this._updateRequiredVatId(d,s))}}},3107:(e,t,i)=>{i.d(t,{Z:()=>r});class r{constructor(){this._request=null,this._errorHandlingInternal=!1}get(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/json",r=this._createPreparedRequest("GET",e,i);return this._sendRequest(r,null,t)}post(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(t,r);let n=this._createPreparedRequest("POST",e,r);return this._sendRequest(n,t,i)}delete(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(t,r);let n=this._createPreparedRequest("DELETE",e,r);return this._sendRequest(n,t,i)}patch(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";r=this._getContentType(t,r);let n=this._createPreparedRequest("PATCH",e,r);return this._sendRequest(n,t,i)}abort(){if(this._request)return this._request.abort()}setErrorHandlingInternal(e){this._errorHandlingInternal=e}_registerOnLoaded(e,t){t&&(!0===this._errorHandlingInternal?(e.addEventListener("load",()=>{t(e.responseText,e)}),e.addEventListener("abort",()=>{console.warn(`the request to ${e.responseURL} was aborted`)}),e.addEventListener("error",()=>{console.warn(`the request to ${e.responseURL} failed with status ${e.status}`)}),e.addEventListener("timeout",()=>{console.warn(`the request to ${e.responseURL} timed out`)})):e.addEventListener("loadend",()=>{t(e.responseText,e)}))}_sendRequest(e,t,i){return this._registerOnLoaded(e,i),e.send(t),e}_getContentType(e,t){return e instanceof FormData&&(t=!1),t}_createPreparedRequest(e,t,i){return this._request=new XMLHttpRequest,this._request.open(e,t),this._request.setRequestHeader("X-Requested-With","XMLHttpRequest"),i&&this._request.setRequestHeader("Content-type",i),this._request}}}}]);