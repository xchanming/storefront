"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["form-country-state-select.plugin"],{6300:(t,e,i)=>{i.r(e),i.d(e,{default:()=>s});var n=i(9568),r=i(4049),o=i(3107);class s extends n.Z{init(){this.initClient(),this.initSelects(),this._getFormFieldToggleInstance(),this._formFieldToggleInstance&&this._formFieldToggleInstance.$emitter.subscribe("onChange",this._onFormFieldToggleChange.bind(this))}initClient(){this._client=new o.Z}initSelects(){this.scopeElement=this.el,this.options.scopeElementSelector&&(this.scopeElement=r.Z.querySelector(document,this.options.scopeElementSelector));let{countrySelectSelector:t,countryStateSelectSelector:e,initialCountryAttribute:i,initialCountryStateAttribute:n,countryStateCitySelectSelector:o,countryStateCityDistrictSelectSelector:a,initialCityAttribute:l,initialDistrictAttribute:u}=s.options,d=r.Z.querySelector(this.scopeElement,t),c=r.Z.querySelector(this.scopeElement,e),h=r.Z.querySelector(this.scopeElement,o),p=r.Z.querySelector(this.scopeElement,a),g=r.Z.getDataAttribute(d,i),q=r.Z.getDataAttribute(c,n),y=r.Z.getDataAttribute(h,l),S=r.Z.getDataAttribute(p,u),b=d.options[d.selectedIndex],C=!!r.Z.getDataAttribute(b,this.options.vatIdRequired,!1),_=document.querySelector(this.options.vatIdFieldInput),m=!!r.Z.getDataAttribute(b,this.options.stateRequired,!1),f=r.Z.querySelectorAll(document,this.options.zipcodeLabel,!1),v=r.Z.querySelectorAll(document,this.options.zipcodeFieldInput,!1),I=!!r.Z.getDataAttribute(b,this.options.zipcodeRequired,!1);d.addEventListener("change",this.onChangeCountry.bind(this)),c.addEventListener("change",this.onChangeCountryState.bind(this)),h.addEventListener("change",this.onChangeCountryStateCity.bind(this)),g&&(this._countryId=g,this.requestStateData(g,q,m),this.requestStateCityData(g,q,y),this.requestStateCityDistrictData(g,y,S),I&&this._updateZipcodeRequired(f,v,I),_&&this._updateRequiredVatId(_,C))}onChangeCountryState(t){let e=t.target.value;this.requestStateCityData(this._countryId,e)}requestStateCityData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=JSON.stringify({countryId:t,parentId:e});this._client.post(window.router["frontend.country.country-data"],n,t=>{let e=JSON.parse(t);!function(t,e,i,n){let{states:o}=t,{countryStateCitySelectSelector:s,countryStateCityPlaceholderSelector:d,countryStateCityDistrictSelectSelector:c,countryStateCityDistrictPlaceholderSelector:h}=n,p=r.Z.querySelector(i,s);a(r.Z.querySelector(i,c),"option:not(".concat(h,")")),a(p,"option:not(".concat(d,")")),l(p,o,e),u(p,"option".concat(d))}(e={...e},i,this.el,s.options)})}requestStateCityDistrictData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=JSON.stringify({countryId:t,parentId:e});this._client.post(window.router["frontend.country.country-data"],n,t=>{let e=JSON.parse(t);!function(t,e,i,n){let{states:o}=t,{countryStateCityDistrictSelectSelector:s,countryStateCityDistrictPlaceholderSelector:d}=n,c=r.Z.querySelector(i,s);a(c,"option:not(".concat(d,")")),l(c,o,e),u(c,"option".concat(d))}(e={...e},i,this.el,s.options)})}onChangeCountryStateCity(t){let e=t.target.value;this.requestStateCityDistrictData(this._countryId,e)}onChangeCountry(t){let e=t.target.value;this._countryId=e;let i=t.target.options[t.target.selectedIndex],n=!!r.Z.getDataAttribute(i,this.options.stateRequired);this.requestStateData(e,null,n);let o=r.Z.getDataAttribute(i,this.options.vatIdRequired),s=document.querySelector(this.options.vatIdFieldInput),a=r.Z.querySelectorAll(this.scopeElement,this.options.zipcodeLabel,!1),l=r.Z.querySelectorAll(this.scopeElement,this.options.zipcodeFieldInput,!1),u=!!r.Z.getDataAttribute(i,this.options.zipcodeRequired,!1);this._updateZipcodeRequired(a,l,u),s&&this._updateRequiredVatId(s,o)}requestStateData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=JSON.stringify({countryId:t});this._client.post(window.router["frontend.country.country-data"],n,t=>{let n=JSON.parse(t);!function(t,e,i,n){let{stateRequired:o,states:s}=t,{countryStateSelectSelector:d,countryStatePlaceholderSelector:c}=n,h=r.Z.querySelector(i,d);a(h,"option:not(".concat(c,")")),l(h,s,e),u(h,o,"option".concat(c))}(n={...n,stateRequired:i},e,this.el,s.options)})}_updateRequiredVatId(t,e){if(this._differentShippingCheckbox&&"billingAddress"===this.options.prefix)return;let i=t.parentNode.querySelector("label");if(e){t.setAttribute("required","required"),(null==i?void 0:i.textContent)&&"*"!==i.textContent.substr(-1,1)&&(i.textContent="".concat(i.textContent,"*"));return}(null==i?void 0:i.textContent)&&"*"===i.textContent.substr(-1,1)&&(i.textContent=i.textContent.substr(0,i.textContent.length-1)),t.removeAttribute("required")}_updateZipcodeRequired(t,e,i){t&&e&&(t.forEach(t=>{t.className=i?"":"d-none"}),e.forEach(t=>{i?t.setAttribute("required","required"):t.removeAttribute("required")}))}_getFormFieldToggleInstance(){let t=r.Z.querySelector(document,'[data-form-field-toggle-target=".js-form-field-toggle-shipping-address"]',!1);t&&(this._formFieldToggleInstance=window.PluginManager.getPluginInstanceFromElement(t,"FormFieldToggle"))}_onFormFieldToggleChange(t){this._differentShippingCheckbox=t.target.checked;let e=this._differentShippingCheckbox?".register-shipping":".register-billing",i=r.Z.querySelector(document,e),n=r.Z.querySelector(i,this.options.countrySelectSelector),o=n.options[n.selectedIndex],s=!!r.Z.getDataAttribute(o,this.options.vatIdRequired,!1),a=document.querySelector(this.options.vatIdFieldInput);a&&this._updateRequiredVatId(a,s)}}function a(t,e){t.querySelectorAll(e).forEach(t=>t.remove())}function l(t,e,i){if(null!==t){if(0===e.length){t.parentNode.classList.add("d-none"),t.setAttribute("disabled","disabled");return}e.map(t=>(function(t,e){let i=document.createElement("option");return i.setAttribute("value",t.id),i.innerText=t.translated.name,t.id===e&&i.setAttribute("selected","selected"),i})(t,i)).forEach(e=>{t.append(e)}),t.parentNode.classList.remove("d-none"),t.removeAttribute("disabled")}}function u(t,e,i){let n=t.querySelector(i);if(!n)return;let r=t.parentNode.querySelector("label");if(e){n.setAttribute("disabled","disabled"),t.setAttribute("required","required"),(null==r?void 0:r.textContent)&&"*"!==r.textContent.substr(-1,1)&&(r.textContent="".concat(r.textContent.trim(),"*"));return}(null==r?void 0:r.textContent)&&"*"===r.textContent.substr(-1,1)&&(r.textContent=r.textContent.substr(0,r.textContent.length-1)),n.removeAttribute("disabled"),t.removeAttribute("required")}s.options={countrySelectSelector:".country-select",initialCountryAttribute:"initial-country-id",countryStateSelectSelector:".country-state-select",countryStateCitySelectSelector:".country-state-city-select",countryStateCityDistrictSelectSelector:".country-state-city-district-select",initialCountryStateAttribute:"initial-country-state-id",initialCityAttribute:"initial-city-id",initialDistrictAttribute:"initial-district-id",countryStatePlaceholderSelector:'[data-placeholder-option="true"]',countryStateCityPlaceholderSelector:"[data-city-placeholder-option]",countryStateCityDistrictPlaceholderSelector:"[data-district-placeholder-option]",vatIdFieldInput:"#vatIds",zipcodeFieldInput:'[data-input-name="zipcodeInput"]',vatIdRequired:"vat-id-required",stateRequired:"state-required",zipcodeRequired:"zipcode-required",zipcodeLabel:"#zipcodeLabel",scopeElementSelector:null,prefix:null}},3107:(t,e,i)=>{i.d(e,{Z:()=>n});class n{get(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/json",n=this._createPreparedRequest("GET",t,i);return this._sendRequest(n,null,e)}post(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";n=this._getContentType(e,n);let r=this._createPreparedRequest("POST",t,n);return this._sendRequest(r,e,i)}delete(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";n=this._getContentType(e,n);let r=this._createPreparedRequest("DELETE",t,n);return this._sendRequest(r,e,i)}patch(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";n=this._getContentType(e,n);let r=this._createPreparedRequest("PATCH",t,n);return this._sendRequest(r,e,i)}abort(){if(this._request)return this._request.abort()}setErrorHandlingInternal(t){this._errorHandlingInternal=t}_registerOnLoaded(t,e){e&&(!0===this._errorHandlingInternal?(t.addEventListener("load",()=>{e(t.responseText,t)}),t.addEventListener("abort",()=>{console.warn("the request to ".concat(t.responseURL," was aborted"))}),t.addEventListener("error",()=>{console.warn("the request to ".concat(t.responseURL," failed with status ").concat(t.status))}),t.addEventListener("timeout",()=>{console.warn("the request to ".concat(t.responseURL," timed out"))})):t.addEventListener("loadend",()=>{e(t.responseText,t)}))}_sendRequest(t,e,i){return this._registerOnLoaded(t,i),t.send(e),t}_getContentType(t,e){return t instanceof FormData&&(e=!1),e}_createPreparedRequest(t,e,i){return this._request=new XMLHttpRequest,this._request.open(t,e),this._request.setRequestHeader("X-Requested-With","XMLHttpRequest"),i&&this._request.setRequestHeader("Content-type",i),this._request}constructor(){this._request=null,this._errorHandlingInternal=!1}}}}]);